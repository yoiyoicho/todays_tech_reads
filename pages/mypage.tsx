/**
 * This original code was generated by v0 by Vercel.
 * @see https://v0.dev/t/YPdBb8ZvvCY
 */

import { GetStaticProps } from 'next';
import Header from '../components/Header';
import ChevronLeftIcon from '../components/ChevronLeftIcon';
import ChevronRightIcon from '../components/ChevronRightIcon';
import Post from '../components/Post';
import PostSubmitForm from '../components/PostSubmitForm';
import prisma from '../lib/prisma';
import { PostType } from '../types/PostType';

type PropsType = {
  posts: PostType[];
}

export default function MyPage({ posts }: PropsType ) {
  return (
    <div key="1" className="bg-[#5590c9] min-h-screen p-4">
      <div className="max-w-2xl mx-auto">
        <Header />
        <div className="grid gap-4">
          <div className="flex items-center justify-center space-x-2 text-2xl font-bold text-[#000000]">
            <ChevronLeftIcon className="h-4 w-4" />
            <span>2023/1/23 Tue.</span>
            <ChevronRightIcon className="h-4 w-4" />
          </div>
          {posts.map((post, index) => (
            <Post key={index} post={post} />
          ))}
        </div>
        <PostSubmitForm />
      </div>
    </div>
  )
}

export const getStaticProps: GetStaticProps = async () => {
  const posts = await prisma.post.findMany({
    select: {
      id: true,
      comment: true,
      article: { // TODO: N+1が起きていないかの確認
        select: {
          id: true,
          url: true,
        },
      },
    },
    // TODO: where句を使ってユーザー、投稿日で絞る
  });
  // TODO: Articleにtitle, description, image情報を追加する
  return {
    props: { posts },
    revalidate: 10,
  };
};
